<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pastel Pocket â€” Beautiful Calculator</title>
  <style>
    :root{
      --bg: linear-gradient(135deg,#f7f3ff 0%, #fffaf0 100%);
      --card: rgba(255,255,255,0.7);
      --glass: rgba(255,255,255,0.55);
      --accent-1: #A8E6CF; /* mint */
      --accent-2: #FFD3B6; /* peach */
      --accent-3: #FFAAA5; /* soft coral */
      --accent-4: #DCE1FF; /* lavender */
      --text: #2b2b2b;
      --muted: #6b6b6b;
      --radius: 18px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;display:flex;align-items:center;justify-content:center;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:28px;
    }

    .wrap{
      width:980px;max-width:98vw;display:grid;grid-template-columns:1fr 360px;gap:20px;align-items:start;
    }

    .card{
      background:var(--card);backdrop-filter: blur(10px) saturate(120%);
      border-radius:var(--radius);box-shadow: 0 10px 30px rgba(20,20,30,0.08);
      padding:20px;
    }

    /* Calculator area */
    .calc{
      padding:18px;border-radius:14px;
      background: linear-gradient(180deg, rgba(255,255,255,0.55), rgba(255,255,255,0.35));
    }

    .top-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{
      width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,var(--accent-1),var(--accent-4));
      display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;box-shadow:0 6px 18px rgba(0,0,0,0.06)
    }
    .title{font-weight:700}
    .subtitle{font-size:12px;color:var(--muted)}

    .controls{display:flex;gap:8px;align-items:center}
    .btn{border:0;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
    .icon-btn{background:transparent;padding:8px;border-radius:10px}

    .display{
      background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
      border-radius:12px;padding:18px;margin-bottom:16px;min-height:84px;display:flex;flex-direction:column;justify-content:center;
      box-shadow: inset 0 -6px 14px rgba(0,0,0,0.03);
    }
    .expr{font-size:18px;color:var(--muted);min-height:22px;word-break:break-all}
    .result{font-size:32px;font-weight:800;line-height:1;}

    .pad{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    button.key{padding:18px;border-radius:12px;border:0;font-size:18px;font-weight:700;cursor:pointer;box-shadow:0 6px 10px rgba(30,30,40,0.05)}

    /* color sets */
    .op{background:linear-gradient(180deg,var(--accent-4),#e8edff);}
    .num{background:linear-gradient(180deg,#ffffff,#f8f8ff)}
    .accent{background:linear-gradient(180deg,var(--accent-2),#fff2e8)}
    .danger{background:linear-gradient(180deg,#ffd1d1,#fff6f6)}

    button.key:active{transform:translateY(2px)}

    /* right panel - history & memory */
    .side{display:flex;flex-direction:column;gap:12px}
    .panel{padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.5));}
    .panel h4{margin:0 0 8px 0}
    .history{max-height:320px;overflow:auto;padding-right:6px}
    .hitem{display:flex;justify-content:space-between;padding:8px;border-radius:8px;margin-bottom:8px;background:linear-gradient(90deg, rgba(255,255,255,0.6), rgba(255,255,255,0.4));}
    .mem-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}

    .small{font-size:13px;color:var(--muted)}

    /* footer tiny controls */
    .tiny{display:flex;gap:8px;align-items:center}

    @media (max-width:880px){
      .wrap{grid-template-columns:1fr;}
      .side{order:2}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card calc">
      <div class="top-row">
        <div class="brand">
          <div class="logo">PP</div>
          <div>
            <div class="title">Pastel Pocket</div>
            <div class="subtitle">a playful, delightful calculator</div>
          </div>
        </div>
        <div class="controls">
          <button class="btn icon-btn" id="themeToggle" title="Toggle theme">ðŸŒ™</button>
          <button class="btn" id="copyBtn">Copy</button>
        </div>
      </div>

      <div class="display" id="display">
        <div class="expr" id="expression">0</div>
        <div class="result" id="result">0</div>
      </div>

      <div class="pad">
        <button class="key danger" data-action="clear">C</button>
        <button class="key op" data-action="back">âŒ«</button>
        <button class="key op" data-value="%">%</button>
        <button class="key op" data-value="/">Ã·</button>

        <button class="key num" data-value="7">7</button>
        <button class="key num" data-value="8">8</button>
        <button class="key num" data-value="9">9</button>
        <button class="key op" data-value="*">Ã—</button>

        <button class="key num" data-value="4">4</button>
        <button class="key num" data-value="5">5</button>
        <button class="key num" data-value="6">6</button>
        <button class="key op" data-value="-">âˆ’</button>

        <button class="key num" data-value="1">1</button>
        <button class="key num" data-value="2">2</button>
        <button class="key num" data-value="3">3</button>
        <button class="key op" data-value="+">+</button>

        <button class="key op" data-action="plusminus">Â±</button>
        <button class="key num" data-value="0">0</button>
        <button class="key num" data-value=".">.</button>
        <button class="key accent" data-action="equals">=</button>

        <!-- extras row - creative features -->
        <button class="key" style="grid-column:span:2;" data-action="sqrt">âˆš</button>
        <button class="key" data-action="sqr">xÂ²</button>
        <button class="key" data-action="recip">1/x</button>
      </div>

      <div style="display:flex;justify-content:space-between;margin-top:12px;align-items:center">
        <div class="small">Keyboard support: type numbers, + - * / Enter</div>
        <div class="tiny">
          <button class="btn" id="themeTiny">Soft theme</button>
          <button class="btn" id="clearHistory">Clear History</button>
        </div>
      </div>
    </div>

    <div class="side">
      <div class="panel">
        <h4>History</h4>
        <div class="history" id="historyList">
          <div class="small">No history yet â€” perform some calculations!</div>
        </div>
      </div>

      <div class="panel">
        <h4>Memory</h4>
        <div class="mem-grid">
          <button class="btn" id="mPlus">M+</button>
          <button class="btn" id="mMinus">M-</button>
          <button class="btn" id="mRecall">MR</button>
          <button class="btn" id="mClear">MC</button>
        </div>
        <div style="margin-top:10px" class="small">Stored: <span id="memVal">0</span></div>
      </div>

      <div class="panel">
        <h4>Extras</h4>
        <div class="small">â€¢ Percent button that works as a modifier. <br>â€¢ Square / âˆš / reciprocal quick actions. <br>â€¢ Persistent history and memory (localStorage).<br>â€¢ Copy result & responsive layout.</div>
      </div>
    </div>
  </div>

  <script>
    // Simple safe evaluator: allow digits, operators, parentheses, decimal point
    const expressionEl = document.getElementById('expression');
    const resultEl = document.getElementById('result');
    const historyList = document.getElementById('historyList');
    const memValEl = document.getElementById('memVal');

    let expr = '';
    let memory = Number(localStorage.getItem('pp_memory') || 0);
    let history = JSON.parse(localStorage.getItem('pp_history') || '[]');
    memValEl.textContent = memory;

    function render(){
      expressionEl.textContent = expr || '0';
      try{ const r = evaluateExpression(expr || '0'); resultEl.textContent = r; }
      catch(e){ resultEl.textContent = 'â€”' }
      renderHistory();
    }

    function sanitize(input){
      // allow digits, operators, parentheses, dot and spaces
      if(input.match(/[^0-9+\-*/%.() \n\t]/)) throw new Error('invalid');
      return input;
    }

    function evaluateExpression(input){
      if(input.trim()==='') return '0';
      // handle percent: transform 50% -> (50/100)
      // But percent in expressions like '200*10%' => 200*(10/100)
      // We'll replace occurrences of number% with (number/100)
      let s = String(input).replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');
      sanitize(s);
      // eslint-disable-next-line no-new-func
      const val = Function('return ('+s+')')();
      if(typeof val === 'number' && !isFinite(val)) throw new Error('bad');
      // round nicely
      return Math.round((val + Number.EPSILON) * 100000000) / 100000000;
    }

    function pushHistory(entry){
      history.unshift(entry);
      history = history.slice(0,60);
      localStorage.setItem('pp_history', JSON.stringify(history));
      renderHistory();
    }

    function renderHistory(){
      if(history.length===0){ historyList.innerHTML = '<div class="small">No history yet â€” perform some calculations!</div>'; return }
      historyList.innerHTML = history.map(h => `\n        <div class="hitem">\n          <div>\n            <div class="small">${escapeHtml(h.e)}</div>\n            <div style=\"font-weight:700\">${escapeHtml(h.r)}</div>\n          </div>\n          <div style=\"display:flex;flex-direction:column;gap:6px\">\n            <button class=\"btn\" onclick=\"useHistory(${history.indexOf(h)})\">Use</button>\n            <button class=\"btn\" onclick=\"copyString('${h.r}')\">Copy</button>\n          </div>\n        </div>`).join('');
    }

    function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    window.useHistory = function(i){ const h = history[i]; if(h){ expr = String(h.e); render(); }}
    window.copyString = function(s){ navigator.clipboard?.writeText(String(s)); alert('Result copied: '+s) }

    document.querySelectorAll('button.key').forEach(b => {
      const v = b.dataset.value;
      const action = b.dataset.action;
      b.addEventListener('click', ()=>{
        if(action){ handleAction(action); }
        else if(v!==undefined){ expr += String(v); render(); }
      })
    })

    function handleAction(a){
      if(a==='clear'){ expr=''; render(); }
      else if(a==='back'){ expr = expr.slice(0,-1); render(); }
      else if(a==='equals'){
        try{ const r = evaluateExpression(expr); pushHistory({e: expr, r}); expr = String(r); render(); }
        catch(e){ resultEl.textContent = 'Error'; }
      }
      else if(a==='plusminus'){
        if(expr.trim()==='') return; try{ const val = evaluateExpression(expr); expr = String(-Number(val)); render(); }catch(e){} }
      else if(a==='sqrt'){
        try{ const val = evaluateExpression(expr||'0'); if(Number(val)<0) throw 'neg'; expr = String(Math.sqrt(Number(val))); render(); }catch(e){resultEl.textContent='Err'} }
      else if(a==='sqr'){
        try{ const val = evaluateExpression(expr||'0'); expr = String(Number(val)*Number(val)); render(); }catch(e){resultEl.textContent='Err'} }
      else if(a==='recip'){
        try{ const val = evaluateExpression(expr||'0'); expr = String(1/Number(val)); render(); }catch(e){resultEl.textContent='Err'} }
    }

    // Memory actions
    document.getElementById('mPlus').addEventListener('click', ()=>{ try{ const v = Number(evaluateExpression(expr||resultEl.textContent||'0')); memory += v; localStorage.setItem('pp_memory', memory); memValEl.textContent = memory; }catch(e){} })
    document.getElementById('mMinus').addEventListener('click', ()=>{ try{ const v = Number(evaluateExpression(expr||resultEl.textContent||'0')); memory -= v; localStorage.setItem('pp_memory', memory); memValEl.textContent = memory; }catch(e){} })
    document.getElementById('mRecall').addEventListener('click', ()=>{ expr += String(memory); render(); })
    document.getElementById('mClear').addEventListener('click', ()=>{ memory = 0; localStorage.setItem('pp_memory', memory); memValEl.textContent = memory; })

    // copy button
    document.getElementById('copyBtn').addEventListener('click', ()=>{ navigator.clipboard?.writeText(resultEl.textContent||''); alert('Copied: '+resultEl.textContent) })

    // clear history
    document.getElementById('clearHistory').addEventListener('click', ()=>{ history=[]; localStorage.removeItem('pp_history'); renderHistory(); })

    // theme toggle
    const themeToggle = document.getElementById('themeToggle');
    themeToggle.addEventListener('click', ()=>{ document.body.classList.toggle('dark'); if(document.body.classList.contains('dark')){ document.documentElement.style.setProperty('--bg','linear-gradient(135deg,#141318,#2b2b3a)'); document.documentElement.style.setProperty('--card','rgba(20,20,30,0.6)'); document.documentElement.style.setProperty('--text','#f5f6fa'); themeToggle.textContent='â˜€ï¸' } else { document.documentElement.style.setProperty('--bg','linear-gradient(135deg,#f7f3ff,#fffaf0)'); document.documentElement.style.setProperty('--card','rgba(255,255,255,0.7)'); document.documentElement.style.setProperty('--text','#2b2b2b'); themeToggle.textContent='ðŸŒ™' } })

    document.getElementById('themeTiny').addEventListener('click', ()=>{ alert('Soft themes are built-in â€” use the moon icon to toggle dark mode.') })

    // keyboard
    window.addEventListener('keydown', (e)=>{
      if((e.key>='0' && e.key<='9') || ['+','-','*','/','(',')','.'].includes(e.key)){
        expr += e.key; render();
      } else if(e.key==='Enter'){
        handleAction('equals');
      } else if(e.key==='Backspace'){
        handleAction('back');
      } else if(e.key==='Escape'){
        handleAction('clear');
      }
    })

    // initial hydrate
    render();

  </script>
</body>
</html>
